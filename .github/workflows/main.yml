name: AvicaRDP
on:
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *'  # Every 6 hours

jobs:
  build:
    name: Start Building...
    runs-on: windows-latest
    timeout-minutes: 350

    steps:
      - name: Configure System
        run: |
          # Enable RDP
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
          
          # Set user password
          net user runneradmin "TheDisa1a" /ADD /Y 2>$null
          net user runneradmin "TheDisa1a"

      - name: Download Files
        run: |
          Invoke-WebRequest -Uri "https://gitlab.com/userup908/my-rdp/-/raw/main/setup.py" -OutFile "setup.py"
          Invoke-WebRequest -Uri "https://gitlab.com/userup908/my-rdp/-/raw/main/show.bat" -OutFile "show.bat"
          Invoke-WebRequest -Uri "https://gitlab.com/userup908/my-rdp/-/raw/main/loop.bat" -OutFile "loop.bat"

      - name: Install Python Packages
        run: python -m pip install requests pyautogui telegraph --quiet

      - name: Run Avica Setup
        run: |
          Write-Host "Starting Avica setup..."
          python setup.py
          Write-Host "Setup completed!" -ForegroundColor Green

      - name: Display Connection Info
        run: |
          Write-Host @"
          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
          â•‘     AVICA RDP CONNECTION      â•‘  
          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          
          ğŸ“± WhatsApp: +923460257488
          ğŸ‘¨â€ğŸ’» Created by USMAN PASHA AKA H4K3R
          
          ğŸ“‹ Instructions:
          â€¢ Go to the GoFile link that will appear below
          â€¢ Get Avica ID and Password from there
          â€¢ Download Avica app and connect
          â€¢ GoFile link changes every time!
          
          â³ Waiting for GoFile link...
"@ -ForegroundColor Cyan

      - name: Start Services
        run: |
          Start-Process cmd -ArgumentList "/c show.bat" -NoNewWindow
          Start-Sleep -Seconds 5
          Start-Process cmd -ArgumentList "/c loop.bat" -NoNewWindow
